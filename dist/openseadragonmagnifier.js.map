{"version":3,"file":"openseadragonmagnifier.js","sources":["../src/magnifier.js"],"sourcesContent":["(function($) {\n    'use strict';\n\n    if (!$.version || $.version.major < 2) {\n        throw new Error('This version of Magnifier requires OpenSeadragon version 2.0.0+');\n    }\n\n    $.Viewer.prototype.magnifier = function(options) {\n        if (!this.magnifierInstance || options) {\n            options = options || {};\n            options.viewer = this;\n            this.magnifierInstance = new $.Magnifier(options);\n        }\n        return this.magnifierInstance;\n    };\n\n    /**\n     * @class Magnifier\n     * @classdesc Allows to view part of the image magnified.\n     * @memberof OpenSeadragon\n     * @param {Object} options\n     */\n    $.Magnifier = function(options) {\n        var viewer = options.viewer,\n            self = this,\n            viewerSize,\n            magnifierSize;\n\n        //We may need to create a new element and id if they did not\n        //provide the id for the existing element\n        if( !options.id ){\n            options.id              = 'magnifier-' + $.now();\n            this.element            = $.makeNeutralElement( 'div' );\n            options.controlOptions  = $.extend(true, {\n                anchor:           $.ControlAnchor.BOTTOM_RIGHT,\n                attachToViewer:   true,\n                autoFade:         false\n            }, options.controlOptions || {});\n\n            if( options.position ){\n                if( 'BOTTOM_RIGHT' === options.position ){\n                   options.controlOptions.anchor = $.ControlAnchor.BOTTOM_RIGHT;\n               } else if( 'BOTTOM_LEFT' === options.position ){\n                   options.controlOptions.anchor = $.ControlAnchor.BOTTOM_LEFT;\n               } else if( 'TOP_RIGHT' === options.position ){\n                   options.controlOptions.anchor = $.ControlAnchor.TOP_RIGHT;\n               } else if( 'TOP_LEFT' === options.position ){\n                   options.controlOptions.anchor = $.ControlAnchor.TOP_LEFT;\n               } else if( 'ABSOLUTE' === options.position ){\n                   options.controlOptions.anchor = $.ControlAnchor.ABSOLUTE;\n                   options.controlOptions.top = options.top;\n                   options.controlOptions.left = options.left;\n                   options.controlOptions.height = options.height;\n                   options.controlOptions.width = options.width;\n                }\n            }\n\n        } else {\n            this.element            = document.getElementById( options.id );\n            options.controlOptions  = $.extend(true, {\n                anchor:           $.ControlAnchor.NONE,\n                attachToViewer:   false,\n                autoFade:         false,\n            }, options.controlOptions || {});\n        }\n        this.element.id         = options.id;\n        this.element.className  += ' magnifier';\n\n        options = $.extend(true, {\n            sizeRatio:              0.2,\n            magnifierRotate:        true, // @TODO\n            viewerWidth: null,\n            viewerHeight: null,\n            minPixelRatio:          viewer.minPixelRatio,\n            defaultZoomLevel:       viewer.viewport.getZoom() * 2,\n            minZoomLevel:           1,\n            keyboardShortcut:       'm',\n            navImages: {\n                magnifier: {\n                    REST: 'selection_rest.png',\n                    GROUP: 'selection_grouphover.png',\n                    HOVER: 'selection_hover.png',\n                    DOWN: 'selection_pressed.png'\n                }\n            }\n        }, options, {\n            element:                this.element,\n            tabIndex:               -1, // No keyboard navigation, omit from tab order\n            //These need to be overridden to prevent recursion since\n            //the magnifier is a viewer and a viewer has a magnifier/navigator\n            showNavigator:          false,\n            showNavigationControl:  false,\n            showSequenceControl:    false,\n            magnifier:              null,\n            immediateRender:        true,\n            blendTime:              0,\n            animationTime:          0,\n            autoResize:             options.autoResize,\n            // prevent resizing the magnifier from adding unwanted space around the image\n            minZoomImageRatio:      1.0,\n        });\n\n        $.setElementTouchActionNone( this.element );\n\n        this.borderWidth = 2;\n        this.viewerWidth = options.viewerWidth;\n        this.viewerHeight = options.viewerHeight;\n\n        //At some browser magnification levels the display regions lines up correctly, but at some there appears to\n        //be a one pixel gap.\n        this.fudge = new $.Point(1, 1);\n        this.totalBorderWidths = new $.Point(this.borderWidth*2, this.borderWidth*2).minus(this.fudge);\n\n        if (options.showMagnifierControl, options.magnifierButton) {\n            var prefix = options.prefixUrl || '';\n            var useGroup = viewer.buttons && viewer.buttons.buttons;\n            var anyButton = useGroup ? viewer.buttons.buttons[0] : null;\n            var onFocusHandler = anyButton ? anyButton.onFocus : null;\n            var onBlurHandler = anyButton ? anyButton.onBlur : null;\n\n            viewer.magnifierButton = new $.Button({\n                element: options.magnifierButton ? $.getElement(options.magnifierButton) : null,\n                clickTimeThreshold: viewer.clickTimeThreshold,\n                clickDistThreshold: viewer.clickDistThreshold,\n                tooltip: $.getString('Tooltips.SelectionToggle') || 'Toggle selection',\n                srcRest: prefix + options.navImages.magnifier.REST,\n                srcGroup: prefix + options.navImages.magnifier.GROUP,\n                srcHover: prefix + options.navImages.magnifier.HOVER,\n                srcDown: prefix + options.navImages.magnifier.DOWN,\n                onRelease: this.toggleVisibility.bind(this),\n                onFocus: onFocusHandler,\n                onBlur: onBlurHandler\n            });\n        }\n\n        if ( options.controlOptions.anchor !== $.ControlAnchor.NONE ) {\n            (function( style, borderWidth ){\n                style.margin        = '0px';\n                style.border        = borderWidth + 'px solid #555';\n                style.padding       = '0px';\n                style.background    = '#000';\n                style.overflow      = 'hidden';\n            }( this.element.style, this.borderWidth));\n        }\n\n        this.displayRegion           = $.makeNeutralElement( 'div' );\n        this.displayRegion.id        = this.element.id + '-displayregion';\n        this.displayRegion.className = 'displayregion';\n\n        (function( style, borderWidth ){\n            style.position      = 'absolute';\n            style.border        = borderWidth + 'px solid #900';\n            style.margin        = '0px';\n            style.padding       = '0px';\n        }( this.displayRegion.style, this.borderWidth ));\n\n        this.regionMoveHangle                 = $.makeNeutralElement( 'div' );\n        this.regionMoveHangle.id              = this.element.id + '-displayregion-move';\n        this.regionMoveHangle.className       = 'displayregion-move';\n        this.regionMoveHangle.style.width     = '10%';\n        this.regionMoveHangle.style.height    = '10%';\n        this.regionMoveHangle.style.maxWidth  = '50px';\n        this.regionMoveHangle.style.maxHeight = '50px';\n        this.regionMoveHangle.style.cursor    = 'move';\n        this.regionMoveHangle.style.background = 'rgba(0, 0, 0, .1)';\n        new $.MouseTracker({\n            element:     this.regionMoveHangle,\n            dragHandler: $.delegate(this, moveRegion),\n        });\n\n        this.regionResizeHangle                 = $.makeNeutralElement( 'div' );\n        this.regionResizeHangle.id              = this.element.id + '-displayregion-move';\n        this.regionResizeHangle.className       = 'displayregion-move';\n        this.regionResizeHangle.style.position  = 'absolute';\n        this.regionResizeHangle.style.bottom    = '-1px';\n        this.regionResizeHangle.style.right     = '-1px';\n        this.regionResizeHangle.style.width     = '10%';\n        this.regionResizeHangle.style.height    = '10%';\n        this.regionResizeHangle.style.maxWidth  = '50px';\n        this.regionResizeHangle.style.maxHeight = '50px';\n        this.regionResizeHangle.style.cursor    = 'se-resize';\n        this.regionResizeHangle.style.background = 'rgba(0, 0, 0, .1)';\n        new $.MouseTracker({\n            element:     this.regionResizeHangle,\n            dragHandler: $.delegate(this, resizeRegion),\n        });\n\n        this.displayRegionContainer              = $.makeNeutralElement('div');\n        this.displayRegionContainer.id           = this.element.id + '-displayregioncontainer';\n        this.displayRegionContainer.className    = 'displayregioncontainer';\n        this.displayRegionContainer.style.width  = '0';\n        this.displayRegionContainer.style.height = '0';\n\n        viewer.addControl(\n            this.element,\n            options.controlOptions\n        );\n\n        this._resizeWithViewer = options.controlOptions.anchor !== $.ControlAnchor.ABSOLUTE &&\n            options.controlOptions.anchor !== $.ControlAnchor.NONE;\n\n        if ( this._resizeWithViewer ) {\n            if ( options.width && options.height ) {\n                this.element.style.height = typeof ( options.height )  === 'number' ? ( options.height + 'px' ) : options.height;\n                this.element.style.width  = typeof ( options.width )  === 'number' ? ( options.width + 'px' ) : options.width;\n            } else {\n                viewerSize = $.getElementSize( viewer.element );\n                this.element.style.height = Math.round( viewerSize.y * options.sizeRatio ) + 'px';\n                this.element.style.width  = Math.round( viewerSize.x * options.sizeRatio ) + 'px';\n                this.oldViewerSize = viewerSize;\n            }\n            magnifierSize = $.getElementSize( this.element );\n            this.elementArea = magnifierSize.x * magnifierSize.y;\n        }\n\n        this.oldContainerSize = new $.Point( 0, 0 );\n\n        $.Viewer.apply(this, [options]);\n\n        this.displayRegion.appendChild(this.regionMoveHangle);\n        this.displayRegion.appendChild(this.regionResizeHangle);\n        this.displayRegionContainer.appendChild(this.displayRegion);\n        viewer.canvas.appendChild(this.displayRegionContainer);\n\n        if (this.keyboardShortcut) {\n            $.addEvent(\n                this.viewer.container,\n                'keypress',\n                $.delegate(this, onKeyPress),\n                false\n            );\n        }\n\n        if (options.magnifierRotate) {\n            viewer.addHandler('rotate', function (args) {\n                var center = viewer.viewport.pixelFromPoint(viewer.viewport.getCenter(), true);\n                self.displayRegionContainer.style.transformOrigin = center.x + 'px ' + center.y + 'px';\n                _setTransformRotate(self.displayRegionContainer, args.degrees);\n                _setTransformRotate(self.displayRegion, -args.degrees);\n                self.viewport.setRotation(args.degrees);\n            });\n        }\n\n        this.addHandler('reset-size', function() {\n            if (self.viewport) {\n                self.viewport.goHome(true);\n            }\n        });\n\n        this.addHandler('update-level', function() {\n            if (viewer.viewport) {\n                self.update(viewer.viewport);\n            }\n        });\n\n        viewer.addHandler('update-level', function() {\n            if (viewer.viewport) {\n                self.update(viewer.viewport);\n            }\n        });\n\n        viewer.addHandler('close', function() {\n            self.close();\n        });\n\n        viewer.addHandler('full-page', function() {\n            if (viewer.viewport) {\n                self.update(viewer.viewport);\n            }\n        });\n\n        viewer.addHandler('full-screen', function() {\n            if (viewer.viewport) {\n                self.update(viewer.viewport);\n            }\n        });\n\n        viewer.world.addHandler('update-viewport', function() {\n            if (viewer.viewport) {\n                self.update(viewer.viewport);\n            }\n        });\n\n        viewer.world.addHandler('item-index-change', function(event) {\n            var item = self.world.getItemAt(event.previousIndex);\n            self.world.setItemIndex(item, event.newIndex);\n        });\n\n        viewer.world.addHandler('remove-item', function(event) {\n            var theirItem = event.item;\n            var myItem = self._getMatchingItem(theirItem);\n            if (myItem) {\n                self.world.removeItem(myItem);\n            }\n        });\n\n        this.storedBounds = null;\n\n        _setTiledImages(this, viewer);\n\n        this.update(viewer.viewport);\n\n    };\n\n    $.extend($.Magnifier.prototype, $.Viewer.prototype, /** @lends OpenSeadragon.Magnifier.prototype */{\n\n        /**\n         * Used to notify the magnifier when its size has changed.\n         * Especially useful when {@link OpenSeadragon.Options}.magnifierAutoResize is set to false and the magnifier is resizable.\n         * @function\n         */\n        updateSize: function () {\n            if ( this.viewport ) {\n                var containerSize = new $.Point(\n                        (this.container.clientWidth === 0 ? 1 : this.container.clientWidth),\n                        (this.container.clientHeight === 0 ? 1 : this.container.clientHeight)\n                    );\n\n                if ( !containerSize.equals( this.oldContainerSize ) ) {\n                    this.viewport.resize( containerSize, true );\n                    this.viewport.goHome(true);\n                    this.oldContainerSize = containerSize;\n                    this.drawer.clear();\n                    this.world.draw();\n                }\n            }\n        },\n\n        /**\n         * Used to update the magnifier's viewport rectangle when a change in the viewer's viewport occurs.\n         * @function\n         * @param {OpenSeadragon.Viewport} The viewport this magnifier is tracking.\n         */\n        update: function( viewport ) {\n            var viewerSize = $.getElementSize( this.viewer.element );\n            if ( this._resizeWithViewer && viewerSize.x && viewerSize.y && !viewerSize.equals( this.oldViewerSize ) ) {\n                var newWidth;\n                var newHeight;\n                this.oldViewerSize = viewerSize;\n\n                if ( this.maintainSizeRatio || !this.elementArea) {\n                    newWidth  = viewerSize.x * this.sizeRatio;\n                    newHeight = viewerSize.y * this.sizeRatio;\n                } else {\n                    newWidth = Math.sqrt(this.elementArea * (viewerSize.x / viewerSize.y));\n                    newHeight = this.elementArea / newWidth;\n                }\n\n                // When dimensions are suplied with the plugin options\n                if (this.viewerWidth && this.viewerHeight) {\n                    newWidth = this.viewerWidth;\n                    newHeight = this.viewerHeight;\n                }\n\n                this.element.style.width  = Math.round( newWidth ) + 'px';\n                this.element.style.height = Math.round( newHeight ) + 'px';\n\n                if (!this.elementArea) {\n                    this.elementArea = newWidth * newHeight;\n                }\n\n                this.updateSize();\n            }\n\n            if (viewport && this.viewport) {\n                var bounds      = this.viewport.getBounds( true );\n                var topleft     = viewport.pixelFromPoint( bounds.getTopLeft(), true );\n                var bottomright = viewport.pixelFromPoint( bounds.getBottomRight(), true )\n                    .minus( this.totalBorderWidths );\n\n                //update style for magnifier-box\n                var style = this.displayRegion.style;\n                style.display = this.world.getItemCount() ? 'block' : 'none';\n\n                style.top    = Math.round( topleft.y ) + 'px';\n                style.left   = Math.round( topleft.x ) + 'px';\n\n                var width = Math.abs( topleft.x - bottomright.x );\n                var height = Math.abs( topleft.y - bottomright.y );\n                // make sure width and height are non-negative so IE doesn't throw\n                style.width  = Math.round( Math.max( width, 0 ) ) + 'px';\n                style.height = Math.round( Math.max( height, 0 ) ) + 'px';\n\n                this.storedBounds = bounds;\n            }\n\n        },\n\n        // overrides Viewer.addTiledImage\n        addTiledImage: function(options) {\n            var _this = this;\n\n            var original = options.originalTiledImage;\n            delete options.original;\n\n            var optionsClone = $.extend({}, options, {\n                success: function(event) {\n                    var myItem = event.item;\n                    myItem._originalForNavigator = original;\n                    _this._matchBounds(myItem, original, true);\n\n                    original.addHandler('bounds-change', function() {\n                        _this._matchBounds(myItem, original);\n                    });\n                }\n            });\n\n            return $.Viewer.prototype.addTiledImage.apply(this, [optionsClone]);\n        },\n\n        toggleVisibility: function() {\n           toggleBlockElement(this.element);\n           toggleBlockElement(this.displayRegionContainer);\n           return this;\n        },\n\n        // private\n        _getMatchingItem: function(theirItem) {\n            var count = this.world.getItemCount();\n            var item;\n            for (var i = 0; i < count; i++) {\n                item = this.world.getItemAt(i);\n                if (item._originalForNavigator === theirItem) {\n                    return item;\n                }\n            }\n\n            return null;\n        },\n\n        // private\n        _matchBounds: function(myItem, theirItem, immediately) {\n            var bounds = theirItem.getBounds();\n            myItem.setPosition(bounds.getTopLeft(), immediately);\n            myItem.setWidth(bounds.width, immediately);\n        }\n    });\n\n    /**\n    * @function\n    * @private\n    * @param {Object} element\n    * @param {Number} degrees\n    */\n    function _setTransformRotate (element, degrees) {\n        element.style.webkitTransform = 'rotate(' + degrees + 'deg)';\n        element.style.mozTransform = 'rotate(' + degrees + 'deg)';\n        element.style.msTransform = 'rotate(' + degrees + 'deg)';\n        element.style.oTransform = 'rotate(' + degrees + 'deg)';\n        element.style.transform = 'rotate(' + degrees + 'deg)';\n    }\n\n    function _setTiledImages(magnifier, viewer) {\n        var tiledImage;\n        for (var i = 0; i < viewer.world.getItemCount(); i++) {\n            tiledImage = viewer.world.getItemAt(i);\n            magnifier.world.addItem(cloneTiledImage(magnifier, tiledImage));\n        }\n        viewer.world.addHandler('add-item', function(event) {\n            magnifier.world.addItem(cloneTiledImage(magnifier, event.item), {\n                index: viewer.world.getIndexOfItem(event.item)\n            });\n\n            if (magnifier.storedBounds) {\n                magnifier.viewport.fitBounds(magnifier.storedBounds, true);\n            }\n        });\n    }\n\n    function cloneTiledImage(magnifier, tiledImage) {\n        var myItem = new $.TiledImage({\n            viewer: magnifier,\n            source: tiledImage.source,\n            viewport: magnifier.viewport,\n            drawer: magnifier.drawer,\n            tileCache: tiledImage._tileCache,\n            imageLoader: tiledImage._imageLoader,\n            clip: tiledImage._clip,\n            placeholderFillStyle: tiledImage.placeholderFillStyle,\n            opacity: tiledImage.opacity,\n            springStiffness: magnifier.springStiffness,\n            animationTime: magnifier.animationTime,\n            minZoomImageRatio: magnifier.minZoomImageRatio,\n            wrapHorizontal: magnifier.wrapHorizontal,\n            wrapVertical: magnifier.wrapVertical,\n            immediateRender: magnifier.immediateRender,\n            blendTime: magnifier.blendTime,\n            alwaysBlend: magnifier.alwaysBlend,\n            minPixelRatio: magnifier.minPixelRatio,\n            smoothTileEdgesMinZoom: magnifier.smoothTileEdgesMinZoom,\n            crossOriginPolicy: magnifier.crossOriginPolicy,\n            debugMode: magnifier.debugMode\n        });\n        myItem._originalForNavigator = tiledImage;\n        magnifier._matchBounds(myItem, tiledImage, true);\n\n        tiledImage.addHandler('bounds-change', function() {\n            magnifier._matchBounds(myItem, tiledImage);\n        });\n\n        return myItem;\n    }\n\n    function moveRegion(event) {\n        if (this.viewport) {\n            if (!this.panHorizontal ){\n                event.delta.x = 0;\n            }\n            if (!this.panVertical){\n                event.delta.y = 0;\n            }\n            this.viewport.panBy(\n                this.viewer.viewport.deltaPointsFromPixels(\n                    event.delta\n                )\n            );\n\n            // store position\n        }\n    }\n\n    function resizeRegion(event) {\n        var bounds      = this.viewport.getBounds( true );\n        var topleft     = this.viewer.viewport.pixelFromPoint( bounds.getTopLeft(), true );\n        var bottomright = this.viewer.viewport.pixelFromPoint( bounds.getBottomRight(), true )\n            .minus( this.totalBorderWidths );\n        var width  = Math.abs( topleft.x - bottomright.x );\n        var height = Math.abs( topleft.y - bottomright.y );\n        var delta  = (event.delta.x / width) + (event.delta.y / height);\n        var zoom = this.viewport.getZoom() * (1 - delta);\n        if (zoom > this.minZoomImageRatio && zoom < this.viewport.getMaxZoom()) {\n            this.viewport.zoomTo(zoom, undefined, true);\n            // this.viewport.panTo(bounds.getCenter().plus(delta), true);\n        }\n    }\n\n    function onKeyPress(e) {\n        var key = e.keyCode || e.charCode;\n         if (String.fromCharCode(key) === this.keyboardShortcut) {\n            this.toggleVisibility();\n        }\n    }\n\n    function toggleBlockElement(el) {\n        el.style.display = el.style.display === 'none' ? 'block' : 'none';\n    }\n\n})(OpenSeadragon);\n"],"names":["$","version","major","Error","_setTransformRotate","element","degrees","style","webkitTransform","mozTransform","msTransform","oTransform","transform","cloneTiledImage","magnifier","tiledImage","myItem","TiledImage","viewer","source","viewport","drawer","tileCache","_tileCache","imageLoader","_imageLoader","clip","_clip","placeholderFillStyle","opacity","springStiffness","animationTime","minZoomImageRatio","wrapHorizontal","wrapVertical","immediateRender","blendTime","alwaysBlend","minPixelRatio","smoothTileEdgesMinZoom","crossOriginPolicy","debugMode","_originalForNavigator","_matchBounds","addHandler","moveRegion","event","this","panHorizontal","delta","x","panVertical","y","panBy","deltaPointsFromPixels","resizeRegion","bounds","getBounds","topleft","pixelFromPoint","getTopLeft","bottomright","getBottomRight","minus","totalBorderWidths","width","Math","abs","height","zoom","getZoom","getMaxZoom","zoomTo","undefined","onKeyPress","e","key","keyCode","charCode","String","fromCharCode","keyboardShortcut","toggleVisibility","toggleBlockElement","el","display","Viewer","prototype","options","magnifierInstance","Magnifier","viewerSize","magnifierSize","borderWidth","self","id","document","getElementById","controlOptions","extend","anchor","ControlAnchor","NONE","attachToViewer","autoFade","now","makeNeutralElement","BOTTOM_RIGHT","position","BOTTOM_LEFT","TOP_RIGHT","TOP_LEFT","ABSOLUTE","top","left","className","sizeRatio","magnifierRotate","viewerWidth","viewerHeight","defaultZoomLevel","minZoomLevel","navImages","REST","GROUP","HOVER","DOWN","tabIndex","showNavigator","showNavigationControl","showSequenceControl","autoResize","setElementTouchActionNone","fudge","Point","showMagnifierControl","magnifierButton","prefix","prefixUrl","anyButton","buttons","onFocusHandler","onFocus","onBlurHandler","onBlur","Button","getElement","clickTimeThreshold","clickDistThreshold","tooltip","getString","srcRest","srcGroup","srcHover","srcDown","onRelease","bind","margin","border","padding","background","overflow","displayRegion","regionMoveHangle","maxWidth","maxHeight","cursor","MouseTracker","dragHandler","delegate","regionResizeHangle","bottom","right","displayRegionContainer","addControl","_resizeWithViewer","getElementSize","round","oldViewerSize","elementArea","oldContainerSize","apply","appendChild","canvas","addEvent","container","args","center","getCenter","transformOrigin","setRotation","goHome","update","close","world","item","getItemAt","previousIndex","setItemIndex","newIndex","theirItem","_getMatchingItem","removeItem","storedBounds","i","getItemCount","addItem","index","getIndexOfItem","fitBounds","_setTiledImages","updateSize","containerSize","clientWidth","clientHeight","equals","resize","clear","draw","newWidth","newHeight","maintainSizeRatio","sqrt","max","addTiledImage","_this","original","originalTiledImage","optionsClone","success","count","immediately","setPosition","setWidth","OpenSeadragon"],"mappings":"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"}