!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";!function(e){if(!e.version||e.version.major<2)throw new Error("This version of Magnifier requires OpenSeadragon version 2.0.0+");function i(e,i){e.style.webkitTransform="rotate("+i+"deg)",e.style.mozTransform="rotate("+i+"deg)",e.style.msTransform="rotate("+i+"deg)",e.style.oTransform="rotate("+i+"deg)",e.style.transform="rotate("+i+"deg)"}function t(i,t){const n=new e.TiledImage({viewer:i,source:t.source,viewport:i.viewport,drawer:i.drawer,tileCache:t._tileCache,imageLoader:t._imageLoader,clip:t._clip,placeholderFillStyle:t.placeholderFillStyle,opacity:t.opacity,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,crossOriginPolicy:i.crossOriginPolicy,debugMode:i.debugMode});return n._originalForNavigator=t,i._matchBounds(n,t,!0),t.addHandler("bounds-change",(function(){i._matchBounds(n,t)})),n}function n(e){this.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.panBy(this.viewer.viewport.deltaPointsFromPixels(e.delta),!0))}function o(e){const i=this.viewport.getBounds(!0),t=this.viewer.viewport.pixelFromPoint(i.getTopLeft(),!0),n=this.viewer.viewport.pixelFromPoint(i.getBottomRight(),!0).minus(this.totalBorderWidths),o=Math.abs(t.x-n.x),s=Math.abs(t.y-n.y),a=e.delta.x/o+e.delta.y/s,r=this.viewport.getZoom(!0)*(1-a);r>this.minZoomImageRatio&&r<this.viewport.getMaxZoom()&&this.viewport.zoomTo(r,void 0,!0)}function s(e){const i=e.keyCode||e.charCode;String.fromCharCode(i)===this.keyboardShortcut&&this.toggleVisibility()}function a(e){e.style.display="none"===e.style.display?"block":"none"}e.Viewer.prototype.magnifier=function(i){return this.magnifierInstance&&!i||((i=i||{}).viewer=this,this.magnifierInstance=new e.Magnifier(i)),this.magnifierInstance},e.Magnifier=function(a){const r=a.viewer,l=this;let h,d;if(a.id?(this.element=document.getElementById(a.id),a.controlOptions=e.extend(!0,{anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1},a.controlOptions||{})):(a.id="magnifier-"+e.now(),this.element=e.makeNeutralElement("div"),a.controlOptions=e.extend(!0,{anchor:e.ControlAnchor.BOTTOM_RIGHT,attachToViewer:!0,autoFade:!1},a.controlOptions||{}),a.position&&("BOTTOM_RIGHT"===a.position?a.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===a.position?a.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===a.position?a.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===a.position?a.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===a.position&&(a.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,a.controlOptions.top=a.top,a.controlOptions.left=a.left,a.controlOptions.height=a.height,a.controlOptions.width=a.width))),this.element.id=a.id,this.element.className+=" magnifier",a=e.extend(!0,{sizeRatio:.2,magnifierRotate:!0,viewerWidth:null,viewerHeight:null,minPixelRatio:r.minPixelRatio,defaultZoomLevel:2*r.viewport.getZoom(!0),minZoomLevel:1,keyboardShortcut:"m",moveMagnifier:!1,navImages:{magnifier:{REST:"selection_rest.png",GROUP:"selection_grouphover.png",HOVER:"selection_hover.png",DOWN:"selection_pressed.png"}}},a,{element:this.element,tabIndex:-1,showNavigator:!1,showNavigationControl:!1,showSequenceControl:!1,magnifier:null,immediateRender:!0,blendTime:0,animationTime:0,autoResize:a.autoResize,minZoomImageRatio:1}),e.setElementTouchActionNone(this.element),this.borderWidth=2,this.viewerWidth=a.viewerWidth,this.viewerHeight=a.viewerHeight,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),a.showMagnifierControl||a.magnifierButton){const i=a.prefixUrl||"",t=r.buttons&&r.buttons.buttons?r.buttons.buttons[0]:null,n=t?t.onFocus:null,o=t?t.onBlur:null;r.magnifierButton=new e.Button({element:a.magnifierButton?e.getElement(a.magnifierButton):null,clickTimeThreshold:r.clickTimeThreshold,clickDistThreshold:r.clickDistThreshold,tooltip:e.getString("Tooltips.SelectionToggle")||"Toggle selection",srcRest:i+a.navImages.magnifier.REST,srcGroup:i+a.navImages.magnifier.GROUP,srcHover:i+a.navImages.magnifier.HOVER,srcDown:i+a.navImages.magnifier.DOWN,onRelease:this.toggleVisibility.bind(this),onFocus:n,onBlur:o})}var g,m;switch(a.controlOptions.anchor!==e.ControlAnchor.NONE&&(g=this.element.style,m=this.borderWidth,g.margin="0px",g.border=m+"px solid #555",g.padding="0px",g.background="#000",g.overflow="hidden",g.minWidth="50px",g.minHeight="50px"),this.magnifierResizeHandle=e.makeNeutralElement("div"),this.magnifierResizeHandle.id=this.element.id+"-magnifier-resize",this.magnifierResizeHandle.className="magnifier-resize",this.magnifierResizeHandle.style.position="absolute",this.magnifierResizeHandle.style.top="-1px",this.magnifierResizeHandle.style.left="-1px",this.magnifierResizeHandle.style.width="10%",this.magnifierResizeHandle.style.height="10%",this.magnifierResizeHandle.style.maxWidth="50px",this.magnifierResizeHandle.style.maxHeight="50px",this.magnifierResizeHandle.style.cursor="nw-resize",this.magnifierResizeHandle.style.zIndex="5",new e.MouseTracker({element:this.magnifierResizeHandle,dragHandler:e.delegate(this,(function(i){const t=e.getElementSize(this.viewer.element);let n=parseInt(this.element.style.width,10)-i.delta.x;n=Math.min(n,.75*t.x),n=Math.max(n,parseInt(this.element.style.minWidth,10)),this.element.style.width=n+"px";let o=parseInt(this.element.style.height,10)-i.delta.y;o=Math.min(o,.75*t.y),o=Math.max(o,parseInt(this.element.style.minHeight,10)),this.element.style.height=o+"px"}))}),this.element.appendChild(this.magnifierResizeHandle),this.magnifierMoveHandle=e.makeNeutralElement("div"),this.magnifierMoveHandle.id=this.element.id+"-magnifier-move",this.magnifierMoveHandle.className="magnifier-move",this.magnifierMoveHandle.style.display=a.moveMagnifier?"block":"none",this.magnifierMoveHandle.style.position="absolute",this.magnifierMoveHandle.style.top="-1px",this.magnifierMoveHandle.style.left="-1px",this.magnifierMoveHandle.style.width="100%",this.magnifierMoveHandle.style.height="100%",this.magnifierMoveHandle.style.cursor="move",this.magnifierMoveHandle.style.zIndex="4",new e.MouseTracker({element:this.magnifierMoveHandle,dragHandler:e=>{let i=Number(this.element.style.right.replace("px","")),t=Number(this.element.style.bottom.replace("px",""));const n=this.element.getBoundingClientRect(),o=r.canvas.getBoundingClientRect(),s=o.width-n.width,a=o.height-n.height;i=Math.min(Math.max(i-e.delta.x,0),s),t=Math.min(Math.max(t-e.delta.y,0),a),this.element.style.right=i+"px",this.element.style.bottom=t+"px"}}),this.element.appendChild(this.magnifierMoveHandle),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,i){e.position="absolute",e.border=i+"px solid #900",e.margin="0px",e.padding="0px"}(this.displayRegion.style,this.borderWidth),this.regionMoveHangle=e.makeNeutralElement("div"),this.regionMoveHangle.id=this.element.id+"-displayregion-move",this.regionMoveHangle.className="displayregion-move",a.regionMoveHandle){case"topLeft":this.regionMoveHangle.style.width="10%",this.regionMoveHangle.style.height="10%",this.regionMoveHangle.style.maxWidth="50px",this.regionMoveHangle.style.maxHeight="50px";break;case"full":this.regionMoveHangle.style.width="100%",this.regionMoveHangle.style.height="100%"}this.regionMoveHangle.style.cursor="move",new e.MouseTracker({element:this.regionMoveHangle,dragHandler:e.delegate(this,n)}),this.regionResizeHangle=e.makeNeutralElement("div"),this.regionResizeHangle.id=this.element.id+"-displayregion-move",this.regionResizeHangle.className="displayregion-move",this.regionResizeHangle.style.position="absolute",this.regionResizeHangle.style.bottom="-1px",this.regionResizeHangle.style.right="-1px",this.regionResizeHangle.style.width="10%",this.regionResizeHangle.style.height="10%",this.regionResizeHangle.style.maxWidth="50px",this.regionResizeHangle.style.maxHeight="50px",this.regionResizeHangle.style.cursor="se-resize",new e.MouseTracker({element:this.regionResizeHangle,dragHandler:e.delegate(this,o)}),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="0",this.displayRegionContainer.style.height="0",r.addControl(this.element,a.controlOptions),this._resizeWithViewer=a.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&a.controlOptions.anchor!==e.ControlAnchor.NONE,this._resizeWithViewer&&(a.width&&a.height?(this.element.style.height="number"==typeof a.height?a.height+"px":a.height,this.element.style.width="number"==typeof a.width?a.width+"px":a.width):(h=e.getElementSize(r.element),this.element.style.height=Math.round(h.y*a.sizeRatio)+"px",this.element.style.width=Math.round(h.x*a.sizeRatio)+"px",this.oldViewerSize=h),d=e.getElementSize(this.element),this.elementArea=d.x*d.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[a]),this.displayRegion.appendChild(this.regionMoveHangle),this.displayRegion.appendChild(this.regionResizeHangle),this.displayRegionContainer.appendChild(this.displayRegion),r.canvas.appendChild(this.displayRegionContainer),this.keyboardShortcut&&e.addEvent(this.viewer.container,"keypress",e.delegate(this,s),!1),a.magnifierRotate&&r.addHandler("rotate",(function(e){const t=r.viewport.pixelFromPoint(r.viewport.getCenter(),!0);l.displayRegionContainer.style.transformOrigin=t.x+"px "+t.y+"px",i(l.displayRegionContainer,e.degrees),i(l.displayRegion,-e.degrees),l.viewport.setRotation(e.degrees)})),this.addHandler("reset-size",(function(){l.viewport&&l.viewport.goHome(!0)})),this.addHandler("update-level",(function(){r.viewport&&l.update(r.viewport)})),r.addHandler("update-level",(function(){r.viewport&&l.update(r.viewport)})),r.addHandler("close",(function(){l.close()})),r.addHandler("full-page",(function(){r.viewport&&l.update(r.viewport)})),r.addHandler("full-screen",(function(){r.viewport&&l.update(r.viewport)})),r.world.addHandler("update-viewport",(function(){r.viewport&&l.update(r.viewport)})),r.world.addHandler("item-index-change",(function(e){const i=l.world.getItemAt(e.previousIndex);l.world.setItemIndex(i,e.newIndex)})),r.world.addHandler("remove-item",(function(e){const i=e.item,t=l._getMatchingItem(i);t&&l.world.removeItem(t)})),this.storedBounds=null,function(e,i){let n;for(let o=0;o<i.world.getItemCount();o++)n=i.world.getItemAt(o),e.world.addItem(t(e,n),{});i.world.addHandler("add-item",(function(n){e.world.addItem(t(e,n.item),{index:i.world.getIndexOfItem(n.item)}),e.storedBounds&&e.viewport.fitBounds(e.storedBounds,!0)}))}(this,r),this.update(r.viewport)},e.extend(e.Magnifier.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){const i=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);i.equals(this.oldContainerSize)||(this.viewport.resize(i,!0),this.viewport.goHome(!0),this.oldContainerSize=i,this.drawer.clear(),this.world.draw())}},update:function(i){const t=e.getElementSize(this.viewer.element);if(this._resizeWithViewer&&t.x&&t.y&&!t.equals(this.oldViewerSize)){let e,i;this.oldViewerSize=t,this.maintainSizeRatio||!this.elementArea?(e=t.x*this.sizeRatio,i=t.y*this.sizeRatio):(e=Math.sqrt(this.elementArea*(t.x/t.y)),i=this.elementArea/e),this.viewerWidth&&this.viewerHeight&&(e=this.viewerWidth,i=this.viewerHeight),this.element.style.width=Math.round(e)+"px",this.element.style.height=Math.round(i)+"px",this.elementArea||(this.elementArea=e*i),this.updateSize()}if(i&&this.viewport){const e=this.viewport.getBounds(!0),t=i.pixelFromPoint(e.getTopLeft(),!0),n=i.pixelFromPoint(e.getBottomRight(),!0).minus(this.totalBorderWidths),o=this.displayRegion.style;o.display=this.world.getItemCount()?"block":"none",o.top=Math.round(t.y)+"px",o.left=Math.round(t.x)+"px";const s=Math.abs(t.x-n.x),a=Math.abs(t.y-n.y);o.width=Math.round(Math.max(s,0))+"px",o.height=Math.round(Math.max(a,0))+"px",this.storedBounds=e}},addTiledImage:function(i){const t=this,n=i.originalTiledImage;delete i.original;const o=e.extend({},i,{success:function(e){const i=e.item;i._originalForNavigator=n,t._matchBounds(i,n,!0),n.addHandler("bounds-change",(function(){t._matchBounds(i,n)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[o])},toggleVisibility:function(){return a(this.element),a(this.displayRegionContainer),this},startMagnifierMove(){this.magnifierMoveHandle.style.display="block"},stopMagnifierMove(){this.magnifierMoveHandle.style.display="none"},_getMatchingItem:function(e){const i=this.world.getItemCount();let t;for(let n=0;n<i;n++)if(t=this.world.getItemAt(n),t._originalForNavigator===e)return t;return null},_matchBounds:function(e,i,t){const n=i.getBounds();e.setPosition(n.getTopLeft(),t),e.setWidth(n.width,t)}})}(OpenSeadragon)}));
//# sourceMappingURL=openseadragonmagnifier.js.map
